stages:
  - lint
  - test

variables:
  PRE_COMMIT_HOME: ${CI_PROJECT_DIR}/.cache/pre-commit
  UV_CACHE_DIR: ${CI_PROJECT_DIR}/.uv-cache

cache:
  paths:
    - ${PRE_COMMIT_HOME}
    - ${UV_CACHE_DIR}
    - frontend/node_modules/

pre-commit:
  stage: lint
  image: python:3.11-slim
  script:
    - pip install pre-commit
    - git init # pre-commit requires a git repo
    - pre-commit run --all-files

backend-test:
  stage: test
  image: python:3.11-slim
  script:
    - pip install uv
    - cd backend
    - uv sync
    - uv run pytest

frontend-test:
  stage: test
  image: node:20
  script:
    - cd frontend
    - npm ci
    - npm run lint
    - npm run build
